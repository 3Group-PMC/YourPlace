define(["./Support","dojo/_base/declare","dojo/query","dojo/_base/lang","dojo/_base/window","dojo/on","dojo/dom-class","dojo/dom-attr","dojo/dom-geometry","dojo/dom-style","dojo/NodeList-dom","dojo/NodeList-traverse","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k="[data-toggle=collapse]",l=b([],{defaultOptions:{toggle:!0},constructor:function(a,b){this.options=d.mixin(d.clone(this.defaultOptions),b||{}),this.domNode=a,this.transitioning=null,this.options.parent&&(this.parent=c(this.options.parent)),this.options.toggle&&this.toggle()},dimension:function(){return g.contains(this.domNode,"width")?"width":"height"},show:function(){var b,d,e,f;if(!this.transitioning&&!g.con){if(this.parent&&this.options.target&&c("[data-target="+this.options.target+"]",this.parent[0]).forEach(function(a){g.remove(a,"collapsed")}),b=this.dimension(),d=a.toCamel(["scroll",b].join("-")),e=this.parent&&c("> .panel > .in",this.parent[0]),e&&e.length){if(f=a.getData(e[0],"collapse"),f&&f.transitioning)return;e.collapse("hide"),f||a.setData(e[0],"collapse",null)}j.set(this.domNode,b,"0px"),this.transition("add","show","shown"),a.trans&&j.set(this.domNode,b,this.domNode[d]+"px")}},hide:function(){if(!this.transitioning&&g.contains(this.domNode,"in")){this.parent&&this.options.target&&c("[data-target="+this.options.target+"]",this.parent[0]).forEach(function(a){g.add(a,"collapsed")});var a=this.dimension();this.reset(j.get(this.domNode,a)),this.transition("remove","hide","hidden"),j.set(this.domNode,a,"0px")}},reset:function(a){a=a?parseFloat(a,10)+"px":"auto";var b=this.dimension();return g.remove(this.domNode,"collapse"),j.set(this.domNode,b,a),this._offsetWidth=this.domNode.offsetWidth,g[null!==a?"add":"remove"](this.domNode,"collapse"),this},transition:function(b,c,e){var h=d.hitch(this,function(){"show"===c&&this.reset(),this.transitioning=0,"add"===b?g.add(this.domNode,"in"):"remove"===b&&g.add(this.domNode,"collapse"),g.remove(this.domNode,"collapsing"),f.emit(this.domNode,e+".bs.collapse",{bubbles:!1,cancelable:!1})});f.emit(this.domNode,c+".bs.collapse",{bubbles:!1,cancelable:!1}),g.remove(this.domNode,"collapse"),g.add(this.domNode,"collapsing"),"remove"===b&&g.remove(this.domNode,"in"),this.transitioning=1,a.trans?(f.once(this.domNode,a.trans.end,h),a.emulateTransitionEnd(this.domNode,350)):h()},toggle:function(){this[g.contains(this.domNode,"in")?"hide":"show"]()}});return d.extend(c.NodeList,{collapse:function(b){var c=d.isObject(b)?b:!1;return this.forEach(function(e){var f=a.getData(e,"collapse");f||a.setData(e,"collapse",f=new l(e,c)),d.isString(b)&&f[b].call(f)})}}),f(e.body(),f.selector(k,"click"),function(b){var d=this;if("collapse"!==a.getData(d,"toggle")&&(d=c(this).closest("[data-toggle=collapse]")[0]),d){var e=h.get(d,"data-target")||b.preventDefault()||a.hrefValue(d);if(e){var f=a.getData(e,"collapse")?"toggle":a.getData(d);c(e).collapse(f)}}}),l});